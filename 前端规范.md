根据您提供的原有规范和实际项目需求，结合BEM方法论，我为您重新拟定了一套全面的前端规范。本规范保留了原有合理部分，并融入了BEM规范、TypeScript最佳实践和Vue 3组合式API标准。

# iFM 小程序项目前端规范（BEM增强版）

## 1. 项目结构规范

### 1.1 目录结构

```
src/
├─ apis/                          # API接口目录
│  ├─ user/                       # 用户相关API
│  │  └─ user.api.ts              # 用户接口文件
│  ├─ clinic/                     # 诊所相关API
│  └─ index.ts                    # API统一导出
│
├─ static/                        # 静态资源
│  ├─ css/                        # 全局样式
│  │  ├─ variables.scss           # SCSS变量
│  │  ├─ mixins.scss              # 混合宏
│  │  └─ index.scss               # 样式入口
│  ├─ icons/                      # 图标资源
│  └─ images/                     # 图片资源
│
├─ components/                    # 组件目录（BEM规范）
│  ├─ universal/                  # 通用组件
│  │  ├─ SearchBox/              # 搜索组件（大驼峰）
│  │  │  ├─ SearchBox.vue         # 组件入口
│  │  │  ├─ SearchBox.module.scss # 组件样式（CSS Modules）
│  │  │  └─ index.ts              # 组件导出
│  │  └─ ...
│  ├─ patient/                    # 患者端专用组件
│  ├─ doctor/                     # 医生端专用组件
│  └─ layout/                     # 布局组件
│
├─ pages/                         # 页面目录
│  ├─ patient/                    # 患者端页面
│  │  ├─ index/                   # 首页
│  │  │  ├─ index.vue             # 页面组件
│  │  │  └─ index.module.scss     # 页面样式
│  │  └─ ...
│  ├─ doctor/                     # 医生端页面
│  └─ common/                     # 公共页面
│
├─ types/                         # TypeScript类型定义
│  ├─ user/                       # 用户相关类型
│  │  ├─ user.types.ts            # 用户类型定义
│  │  └─ index.ts                 # 类型导出
│  ├─ clinic/                     # 诊所相关类型
│  └─ global.d.ts                 # 全局类型
│
├─ stores/                        # Pinia状态管理
│  ├─ user.store.ts               # 用户状态
│  ├─ clinic.store.ts             # 诊所状态
│  └─ index.ts                    # Store导出
│
├─ utils/                         # 工具函数
│  ├─ request.ts                  # 请求封装
│  ├─ validate.ts                 # 验证工具
│  ├─ format.ts                   # 格式化工具
│  └─ index.ts                    # 工具导出
│
├─ hooks/                         # 组合式函数
│  ├─ useUser.ts                  # 用户相关逻辑
│  ├─ useClinic.ts                # 诊所相关逻辑
│  └─ index.ts                    # Hooks导出
│
└─ main.ts                        # 应用入口
```

### 1.2 文件命名规范

- **组件文件**：大驼峰命名，如 `SearchBox.vue`
- **页面文件**：kebab-case命名，如 `patient-index.vue`
- **类型文件**：kebab-case命名，如 `user.types.ts`
- **工具文件**：camelCase命名，如 `formatDate.ts`

## 2. TypeScript 规范

### 2.1 类型定义规范

```
// ✅ 正确示例
/* 用户基本信息 */
interface IUserBaseInfo {
  // 用户ID
  userId: number
  // 用户名
  username: string
  // 手机号码
  phone: string
  // 头像URL
  avatarUrl: string
}

/* 用户详情信息 */
type TUserDetail = IUserBaseInfo & {
  // 邮箱地址
  email: string
  // 注册时间
  registerTime: string
  // 最后登录时间
  lastLoginTime: string
}

// ❌ 避免使用
interface User {}  // 缺少I前缀
type UserInfo = {} // 缺少T前缀
```

### 2.2 组件Props类型定义

```
// components/universal/SearchBox/SearchBox.vue
interface ISearchBoxProps {
  // 占位符文本
  placeholder?: string
  // 是否可清空
  clearable?: boolean
  // 搜索关键词（双向绑定）
  modelValue: string
  // 搜索框背景色
  bgColor?: string
}

// 使用泛型定义默认值
withDefaults(defineProps<ISearchBoxProps>(), {
  placeholder: '搜索内容',
  clearable: true,
  bgColor: '#ffffff'
})
```

### 2.3 接口响应类型

```
// types/api.types.ts
/* 统一API响应格式 */
interface IApiResponse<T = any> {
  // 是否成功
  success: boolean
  // 状态码
  code: number
  // 消息
  message: string
  // 数据
  data: T
}

/* 分页数据格式 */
interface IPaginationData<T = any> {
  // 数据列表
  list: T[]
  // 总条数
  total: number
  // 当前页
  current: number
  // 每页大小
  size: number
}
```

## 3. Vue组件规范

### 3.1 组件结构规范

```
<template>
  <!-- BEM块级元素 -->
  <view class="search-box">
    <!-- BEM元素 -->
    <view class="search-box__input-container">
      <input 
        class="search-box__input"
        :placeholder="placeholder"
        v-model="keyword"
      />
      <!-- BEM修饰符 -->
      <view 
        class="search-box__clear-btn search-box__clear-btn--visible"
        @click="handleClear"
      >
        ×
      </view>
    </view>
  </view>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'

interface IProps {
  placeholder?: string
}

const props = withDefaults(defineProps<IProps>(), {
  placeholder: '请输入搜索内容'
})

const keyword = ref<string>('')

// 事件处理函数使用handle前缀
const handleClear = () => {
  keyword.value = ''
}

// 计算属性使用camelCase
const isEmpty = computed(() => keyword.value.length === 0)
</script>

<style lang="scss" scoped>
// BEM规范样式编写
.search-box {
  width: 100%;
  
  &__input-container {
    position: relative;
    display: flex;
    align-items: center;
  }
  
  &__input {
    flex: 1;
    padding: 20rpx;
    border: 1px solid #ddd;
    border-radius: 8rpx;
  }
  
  &__clear-btn {
    display: none;
    position: absolute;
    right: 10rpx;
    
    &--visible {
      display: block;
    }
  }
}
</style>
```

### 3.2 BEM命名规范详解

#### 3.2.1 BEM结构定义

```
/* 块（Block） */
.component-name {
  /* 块级样式 */
  
  /* 元素（Element） */
  &__element-name {
    /* 元素样式 */
    
    /* 修饰符（Modifier） */
    &--modifier-name {
      /* 修饰符样式 */
    }
  }
}
```

#### 3.2.2 实际应用示例

```
// 患者首页样式
.index-patient {
  min-height: 100vh;
  background-color: $bg-color;
  
  // 顶部区域元素
  &__top-section {
    background: linear-gradient(to bottom, $qingse-light, #FFFFFF);
    padding: 25rpx;
  }
  
  // 位置信息元素
  &__location {
    display: flex;
    align-items: center;
    
    // 位置图标元素
    &-icon {
      margin-right: 20rpx;
      font-size: 40rpx;
    }
    
    // 位置文本元素
    &-text {
      font-size: 30rpx;
    }
  }
  
  // 修饰符：紧凑布局
  &--compact {
    .index-patient__top-section {
      padding: 15rpx;
    }
  }
}

// 健康任务组件
.health-task {
  padding: 20rpx;
  
  &__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  &__title {
    font-size: 32rpx;
    font-weight: 600;
    
    // 修饰符：次要标题
    &--secondary {
      font-size: 28rpx;
      color: #666;
    }
  }
  
  &__body {
    margin-top: 20rpx;
  }
}
```

### 3.3 组件通信规范

```
<!-- 子组件 -->
<script setup lang="ts">
interface IEmits {
  (e: 'search', keyword: string): void
  (e: 'clear'): void
  (e: 'update:modelValue', value: string): void
}

const emit = defineEmits<IEmits>()

const handleSearch = () => {
  emit('search', keyword.value)
}

const handleClear = () => {
  emit('clear')
  emit('update:modelValue', '')
}
</script>

<!-- 父组件使用 -->
<template>
  <search-box
    v-model="searchKeyword"
    @search="handleSearch"
    @clear="handleClear"
  />
</template>
```

## 4. 样式编写规范

### 4.1 SCSS变量和混合宏

```
// assets/css/variables.scss
// 颜色变量
$primary-color: #49B9AD;
$success-color: #67C23A;
$warning-color: #E6A23C;
$danger-color: #F56C6C;
$info-color: #909399;

// 背景色
$bg-color: #F5F5F5;
$qingse-light: #F0FFF9;

// 字体大小
$font-size-small: 24rpx;
$font-size-base: 28rpx;
$font-size-medium: 32rpx;
$font-size-large: 36rpx;

// 间距
$spacing-small: 20rpx;
$spacing-base: 30rpx;
$spacing-large: 40rpx;

// assets/css/mixins.scss
// 文字省略
@mixin text-ellipsis($line: 1) {
  @if $line == 1 {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  } @else {
    display: -webkit-box;
    -webkit-line-clamp: $line;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
}

// 弹性布局居中
@mixin flex-center($direction: row) {
  display: flex;
  flex-direction: $direction;
  justify-content: center;
  align-items: center;
}

// 定位居中
@mixin position-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
```

### 4.2 样式作用域管理

```
<style lang="scss" scoped>
// 使用CSS Modules避免样式污染
.index-patient {
  :deep(.u-search__content) {  // 深度选择器
    border-radius: 10px;
  }
  
  :slotted(.custom-content) {   // 插槽选择器
    margin-top: 20rpx;
  }
}
</style>

<!-- 或者使用CSS Modules -->
<style lang="scss" module>
.container {
  composes: base-container from '@/assets/css/base.scss';
}

.title {
  composes: text-ellipsis from '@/assets/css/mixins.scss';
  font-size: 32rpx;
}
</style>
```

## 5. 代码风格规范

### 5.1 命名约定

```
// 变量和函数 - camelCase
const userName = ref('')
const isLoading = ref(false)
const getUserInfo = () => {}
const handleButtonClick = () => {}

// 常量 - UPPER_SNAKE_CASE
const API_TIMEOUT = 10000
const DEFAULT_AVATAR = '/static/images/avatar-default.png'

// 类型和接口 - PascalCase with I/T prefix
interface IUserInfo {}
type TApiResponse = {}

// 组件 - PascalCase
// 文件名：SearchBox.vue
// 组件名：SearchBox
```

### 5.2 组合式API规范

```
// hooks/useUser.ts
import { ref, computed } from 'vue'
import { useUserStore } from '@/stores/user'

export function useUser() {
  const userStore = useUserStore()
  
  // 用户信息
  const userInfo = computed(() => userStore.userInfo)
  
  // 登录状态
  const isLoggedIn = computed(() => userStore.isLoggedIn)
  
  // 登录方法
  const login = async (credentials: ILoginForm) => {
    try {
      const result = await userStore.login(credentials)
      return result
    } catch (error) {
      throw error
    }
  }
  
  return {
    userInfo,
    isLoggedIn,
    login
  }
}

// 在组件中使用
<script setup lang="ts">
import { useUser } from '@/hooks/useUser'

const { userInfo, isLoggedIn, login } = useUser()
</script>
```

## 6. 页面开发规范

### 6.1 页面结构规范

```
<!-- pages/patient/index.vue -->
<template>
  <!-- BEM块级容器 -->
  <view class="page-patient-index">
    <!-- 页面头部 -->
    <patient-header class="page-patient-index__header" />
    
    <!-- 主要内容区域 -->
    <view class="page-patient-index__main">
      <!-- 健康任务区域 -->
      <health-task-section class="page-patient-index__health-task" />
      
      <!-- 诊所推荐区域 -->
      <clinic-recommend-section class="page-patient-index__clinic-recommend" />
    </view>
    
    <!-- 页面底部 -->
    <patient-footer class="page-patient-index__footer" />
  </view>
</template>

<script setup lang="ts">
import { onLoad } from '@dcloudio/uni-app'
import { usePatientHome } from './usePatientHome'

// 使用组合式函数组织逻辑
const {
  // 状态
  healthTasks,
  recommendedClinics,
  isLoading,
  
  // 方法
  loadData,
  handleTaskClick,
  handleClinicClick
} = usePatientHome()

onLoad(() => {
  loadData()
})
</script>

<style lang="scss" scoped>
.page-patient-index {
  min-height: 100vh;
  background-color: $bg-color;
  
  &__header {
    position: sticky;
    top: 0;
    z-index: 100;
  }
  
  &__main {
    padding: $spacing-base;
  }
  
  &__health-task {
    margin-bottom: $spacing-large;
  }
  
  &__clinic-recommend {
    // 特定样式
  }
}
</style>
```

### 6.2 页面逻辑组织

```
// pages/patient/index/usePatientHome.ts
import { ref, computed } from 'vue'
import { onLoad } from '@dcloudio/uni-app'
import { useClinicApi } from '@/apis/clinic'
import { useTaskApi } from '@/apis/task'

export function usePatientHome() {
  // 响应式状态
  const healthTasks = ref([])
  const recommendedClinics = ref([])
  const isLoading = ref(false)
  
  // API调用
  const clinicApi = useClinicApi()
  const taskApi = useTaskApi()
  
  // 计算属性
  const hasTasks = computed(() => healthTasks.value.length > 0)
  const hasClinics = computed(() => recommendedClinics.value.length > 0)
  
  // 方法
  const loadData = async () => {
    isLoading.value = true
    try {
      const [tasks, clinics] = await Promise.all([
        taskApi.getTodayTasks(),
        clinicApi.getRecommendations()
      ])
      
      healthTasks.value = tasks
      recommendedClinics.value = clinics
    } catch (error) {
      console.error('加载数据失败:', error)
    } finally {
      isLoading.value = false
    }
  }
  
  const handleTaskClick = (task: ITask) => {
    uni.navigateTo({
      url: `/pages/task/detail?id=${task.id}`
    })
  }
  
  const handleClinicClick = (clinic: IClinic) => {
    uni.navigateTo({
      url: `/pages/clinic/detail?id=${clinic.id}`
    })
  }
  
  // 生命周期
  onLoad(() => {
    loadData()
  })
  
  return {
    // 状态
    healthTasks,
    recommendedClinics,
    isLoading,
    
    // 计算属性
    hasTasks,
    hasClinics,
    
    // 方法
    loadData,
    handleTaskClick,
    handleClinicClick
  }
}
```

## 7. 性能优化规范

### 7.1 组件优化

```
<!-- 使用v-show替代v-if when appropriate -->
<view v-show="isVisible" class="modal">...</view>

<!-- 列表渲染使用key -->
<view 
  v-for="item in list" 
  :key="item.id"
  class="list-item"
>
  {{ item.name }}
</view>

<!-- 懒加载组件 -->
<template>
  <lazy-component>
    <heavy-component />
  </lazy-component>
</template>
```

### 7.2 图片优化

```
<template>
  <!-- 使用懒加载 -->
  <image 
    lazy-load 
    :src="imageUrl" 
    mode="aspectFill"
    @error="handleImageError"
  />
</template>

<script setup>
const handleImageError = (event) => {
  event.target.src = '/static/images/error-image.png'
}
</script>
```

## 8. 提交约定

### 8.1 Git提交信息规范

```
feat: 新增患者端首页BEM样式重构
fix: 修复搜索框样式重叠问题
docs: 更新前端规范文档
style: 调整代码格式，不影响逻辑
refactor: 重构健康任务组件结构
test: 添加用户登录测试用例
chore: 更新依赖包版本
```

本规范结合了BEM方法论、Vue 3最佳实践和TypeScript严格类型检查，能够有效提升代码可维护性和团队协作效率。建议在项目中逐步实施，并通过代码审查确保规范执行。